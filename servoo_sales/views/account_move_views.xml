<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record model="ir.ui.view" id="view_servoo_move_tree">
        <field name="name">servoo.account.move.tree</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_out_invoice_tree" />
        <field name="arch" type="xml">
            <field name="invoice_origin" position="before">
                <field name="apm_reference"/>
            </field>
        </field>
    </record>

        <record model="ir.ui.view" id="view_servoo_move_form">
            <field name="name">servoo.account.move.form</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form" />
            <field name="arch" type="xml">
                <field name="invoice_origin" position="before">
                    <field name="apm_reference" readonly="1" />
                    <field name="agency_name" required="1" />
                    <field name="department_id" readonly="1" attrs="{'invisible': [('move_type', '!=', 'in_invoice')]}"  />
                    <field name="sale_order_template_id" attrs="{'invisible': [('move_type', '!=', 'out_invoice')]}"
                        options="{'no_create': True, 'no_open': True}"
                        groups="sale_management.group_sale_order_template"
                    />
                </field>
                <field name="payment_reference" position="replace" />
                <field name="narration" position="before">
                    <label for="distribute_ht_amount" colspan="2" />
                    <field name="distribute_ht_amount"  colspan="2" nolabel="1"/>
                </field>
                <field name="narration" position="after">
                    <label for="amount_total_in_currency_signed_letter" string="Stopped this invoice for the sum" colspan="2"/>
                    <field name="amount_total_in_currency_signed_letter" readonly="1" nolabel="1" colspan="2"/>
                </field>
                <field name="tax_totals_json" position="after">
                    <label for="amount_other_currency" string="Other Total"/>
                    <div class="o_row">
                             <field name="amount_other_currency" />
                             <field name="other_currency_id" readonly="1"/>
                        </div>
                </field>
                <notebook position="before">


                    <group col="4" attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund'))]}">
                        <field name="import_pad_invoice" attrs="{'invisible': [('additional_invoice', '=', True)]}"/>
                        <field name="export_pad_invoice" attrs="{'invisible': [('additional_invoice', '=', True)]}"/>
                        <field name="additional_invoice" colspan="4" attrs="{'readonly': ['|',('import_pad_invoice', '=', True), ('export_pad_invoice', '=', True)]}"/>

                        <field name="loading_place_id" />
                        <field name="unloading_place_id" />
                        <field name="transport_means_id" />
                        <field name="travel_date" />
                        <field name="transport_letter" />
                        <field name="assessed_value" />
                        <label for="weight" />
                        <div class="o_row">
                             <field name="weight" />
                             <field name="unit_id" options="{'no_open': True, 'no_create': False}" />
                        </div>
                        <field name="volume" />
                        <field name="custom_declaration_reference" />
                        <field name="custom_declaration_date" />
                        <field name="number_of_packages" />
                         <field name="object" colspan="4"/>
                    </group>
                    <group string="Main rate" col="4" attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund'))]}">
                        <field name="handling_rate_id" colspan="4"/>
                        <field name="rate_type" readonly="1" />
                        <field name="include_tax_for_handling" />
                        <field name="handling" />
                        <field name="quantity" />
                    </group>
                    <group string="Second rate" col="4" attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund'))]}">
                        <field name="handling_rate_2_id" colspan="4"/>
                        <field name="rate_type_2" readonly="1" />
                        <field name="include_tax_for_handling2" />
                        <field name="handling2" />
                        <field name="quantity2" />
                    </group>
                    <group string="Third rate" col="4" attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund'))]}">
                        <field name="handling_rate_3_id" colspan="4"/>
                        <field name="rate_type_3" readonly="1" />
                        <field name="include_tax_for_handling3" />
                        <field name="handling3" />
                        <field name="quantity3" />
                    </group>
                </notebook>
<!--                <field name="state" position="replace">-->
<!--                    <field name="state" widget="statusbar" statusbar_visible="draft,posted" attrs="{'invisible': [('move_type', '=', 'in_invoice')]}"/>-->
<!--                    <field name="state" widget="statusbar" statusbar_visible="draft,direction_routing,department_approval,direction_approval,accounting_approval,management_control_approval,posted" attrs="{'invisible': [('move_type', '!=', 'in_invoice')]}"/>-->
<!--                </field>-->
                <button name="action_post" position="after">
                    <button name="action_submit" class="oe_highlight" string="Send to Direction" type="object"
                            groups="servoo_sales.group_supplier_invoice_admissibility"
                            attrs="{'invisible': ['|',('move_type', '!=', 'in_invoice'), ('state', '!=', 'draft')]}" />
                    <button name="%(action_wizard_supplier_invoice)d" string="Send to Department" class="oe_highlight" type="action"
                            groups="servoo_sales.group_supplier_invoice_general_direction"
                            attrs="{'invisible': ['|',('move_type', '!=', 'in_invoice'), ('state', '!=', 'direction_routing')]}" />
                    <button name="%(action_wizard_supplier_validation_invoice)d" string="Send to Accounting" class="oe_highlight" type="action"
                            groups="servoo_sales.group_supplier_invoice_general_direction"
                            attrs="{'invisible': ['|',('move_type', '!=', 'in_invoice'), ('state', '!=', 'direction_routing')]}" />
                    <button name="%(action_wizard_supplier_invoice)d" string="Approve" class="oe_highlight" type="action"
                            groups="servoo_sales.group_supplier_invoice_department"
                            attrs="{'invisible': ['|',('move_type', '!=', 'in_invoice'), ('state', '!=', 'department_approval')]}" />
                    <button name="%(action_wizard_supplier_invoice)d" string="Approve" class="oe_highlight" type="action"
                            groups="servoo_sales.group_supplier_invoice_general_direction"
                            attrs="{'invisible': ['|',('move_type', '!=', 'in_invoice'), ('state', '!=', 'direction_approval')]}" />
                    <button name="%(action_wizard_supplier_invoice)d" string="Put in payment" class="oe_highlight" type="action"
                            groups="servoo_sales.group_supplier_invoice_accounting"
                            attrs="{'invisible': ['|',('move_type', '!=', 'in_invoice'), ('state', '!=', 'accounting_approval')]}" />
                    <button name="%(action_wizard_supplier_invoice)d" string="Approve" class="oe_highlight" type="action"
                            groups="servoo_sales.group_supplier_invoice_management_control"
                            attrs="{'invisible': ['|',('move_type', '!=', 'in_invoice'), ('state', '!=', 'management_control_approval')]}" />
                </button>
                <field name="price_unit" position="after">
                    <field name="no_days" optional="hide" force_save="1"/>
                </field>
                <xpath expr="//field[@name='line_ids']/tree/field[@name='account_id']" position="before">
                    <field name="no_days" invisible="1"/>
                </xpath>
            </field>
        </record>

    <record model="ir.ui.view" id="servoo_account_move_search">
        <field name="name">account.move.search</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter" />
        <field name="arch" type="xml">
            <field name="journal_id" position="before">
                <field name="apm_reference" />
            </field>
        </field>
    </record>
</odoo>
